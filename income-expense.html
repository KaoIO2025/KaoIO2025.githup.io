<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ระบบบันทึกรายรับ-รายจ่าย</title>
  <!-- ใช้ Tailwind CSS และ Chart.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 font-sans">

  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-6 text-center">บันทึกรายรับ-รายจ่าย</h1>
    
    <!-- ฟอร์มเพิ่มรายการ -->
    <div class="mb-4">
      <input id="amount" type="number" placeholder="จำนวนเงิน" class="p-2 border rounded w-full mb-2" />
      <select id="category" class="p-2 border rounded w-full mb-2">
        <option value="อาหาร">อาหาร</option>
        <option value="ค่าบ้าน">ค่าบ้าน</option>
        <option value="ค่าขนส่ง">ค่าขนส่ง</option>
        <option value="บันเทิง">บันเทิง</option>
        <option value="อื่นๆ">อื่นๆ</option>
      </select>
      <textarea id="description" placeholder="รายละเอียด" class="p-2 border rounded w-full mb-2"></textarea>
      <button id="add-entry" class="w-full bg-blue-500 text-white p-2 rounded">เพิ่มรายการ</button>
    </div>

    <!-- กราฟรายรับ-รายจ่าย -->
    <div class="mb-4">
      <canvas id="expenseChart"></canvas>
    </div>

    <!-- รายการที่บันทึก -->
    <div id="entry-list" class="space-y-4">
      <!-- รายการจะถูกแสดงที่นี่ -->
    </div>
  </div>

  <script>
    // ฟังก์ชันเพื่อเพิ่มรายการและบันทึกใน localStorage
    const addEntryButton = document.getElementById('add-entry');
    addEntryButton.addEventListener('click', function() {
      const amount = document.getElementById('amount').value;
      const category = document.getElementById('category').value;
      const description = document.getElementById('description').value;
      const date = new Date().toLocaleString();

      if (amount && category && description) {
        const entry = { amount, category, description, date };

        // อ่านข้อมูลจาก localStorage แล้วเพิ่มรายการใหม่
        let entries = JSON.parse(localStorage.getItem('entries')) || [];
        entries.push(entry);
        localStorage.setItem('entries', JSON.stringify(entries));

        // แสดงรายการใหม่
        displayEntries();
        updateChart();
      }
    });

    // ฟังก์ชันเพื่อแสดงรายการทั้งหมด
    function displayEntries() {
      const entryList = document.getElementById('entry-list');
      entryList.innerHTML = '';

      let entries = JSON.parse(localStorage.getItem('entries')) || [];

      entries.forEach((entry, index) => {
        const entryElement = document.createElement('div');
        entryElement.classList.add('bg-white', 'p-4', 'rounded', 'shadow-md');
        
        entryElement.innerHTML = `
          <div><strong>จำนวนเงิน:</strong> ${entry.amount} บาท</div>
          <div><strong>หมวดหมู่:</strong> ${entry.category}</div>
          <div><strong>รายละเอียด:</strong> ${entry.description}</div>
          <div><strong>วันที่:</strong> ${entry.date}</div>
          <button class="text-red-500 mt-2" onclick="deleteEntry(${index})">ลบ</button>
          <button class="text-yellow-500 mt-2" onclick="editEntry(${index})">แก้ไข</button>
        `;

        entryList.appendChild(entryElement);
      });
    }

    // ฟังก์ชันลบรายการ
    function deleteEntry(index) {
      let entries = JSON.parse(localStorage.getItem('entries')) || [];
      entries.splice(index, 1);
      localStorage.setItem('entries', JSON.stringify(entries));
      displayEntries();
      updateChart();
    }

    // ฟังก์ชันแก้ไขรายการ
    function editEntry(index) {
      let entries = JSON.parse(localStorage.getItem('entries')) || [];
      const entry = entries[index];

      document.getElementById('amount').value = entry.amount;
      document.getElementById('category').value = entry.category;
      document.getElementById('description').value = entry.description;

      deleteEntry(index);
    }

    // ฟังก์ชันแสดงกราฟรายรับ-รายจ่าย
    function updateChart() {
      let entries = JSON.parse(localStorage.getItem('entries')) || [];

      let categories = {};
      entries.forEach(entry => {
        if (!categories[entry.category]) {
          categories[entry.category] = 0;
        }
        categories[entry.category] += parseFloat(entry.amount);
      });

      const ctx = document.getElementById('expenseChart').getContext('2d');
      const chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(categories),
          datasets: [{
            label: 'รายจ่าย',
            data: Object.values(categories),
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    // เรียกใช้ฟังก์ชันแสดงรายการเมื่อโหลดหน้า
    displayEntries();
    updateChart();
  </script>

</body>
</html>
